version: 2.0

test:
    image:
        daocloud/ci-python:3.4

    services:
        - postgresql

    env:
        - POSTGRESQL_INSTANCE_NAME=postgres
        - POSTGRESQL_USERNAME=postgres
        - POSTGRESQL_PASSWORD=
        - POSTGRESQL_PORT_5432_TCP_ADDR=1.2.3.4
        - POSTGRESQL_PORT_5432_TCP_PORT=5432

    install:
        - sudo apt-get update
        - pip install coverage

    before_script:
        - pip install -r requirements.txt

    script:
        - coverage run --source='.' manage.py test
        - coverage report

build:
    image:
        dockerfile_path: Dockerfile
        build_dir: /
        cache: true